<!DOCTYPE html><html lang="en-us" >

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.1.0 for Hugo" />
  

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Mark LeBoeuf" />

  
  
  
    
  
  <meta name="description" content="Portland, Oregon is home to some of the best watering holes in America. With so many places to quaff a West Coast Style IPA or glass of Pinot Noir, choosing which to visit (and in which order) can be a daunting task. To address this question, we&#39;ll leverage some classic optimization techniques to minimize the total distance travelled between the top bars in Portland for a truly &#34;optimal&#34; Pub Crawl." />

  
  <link rel="alternate" hreflang="en-us" href="http://example.org/post/2018-06-01-optimal-bar-crawl/optimal_bar_crawl/" />

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">

    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/tomorrow-night-eighties.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/tomorrow-night-eighties.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      
        
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.7e30e35693ce5241bf21fbf454066bdd.css" />

  



  

  

  




  
  
  

  

  
    <link rel="manifest" href="/index.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_huc737709a4be44af6221d1cabfe197959_22580_32x32_fill_lanczos_center_2.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_huc737709a4be44af6221d1cabfe197959_22580_180x180_fill_lanczos_center_2.png" />

  <link rel="canonical" href="http://example.org/post/2018-06-01-optimal-bar-crawl/optimal_bar_crawl/" />

  
  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="The Code Forest" />
  <meta property="og:url" content="http://example.org/post/2018-06-01-optimal-bar-crawl/optimal_bar_crawl/" />
  <meta property="og:title" content="The Optimal Portland Pub Crawl | The Code Forest" />
  <meta property="og:description" content="Portland, Oregon is home to some of the best watering holes in America. With so many places to quaff a West Coast Style IPA or glass of Pinot Noir, choosing which to visit (and in which order) can be a daunting task. To address this question, we&#39;ll leverage some classic optimization techniques to minimize the total distance travelled between the top bars in Portland for a truly &#34;optimal&#34; Pub Crawl." /><meta property="og:image" content="http://example.org/media/icon_huc737709a4be44af6221d1cabfe197959_22580_512x512_fill_lanczos_center_2.png" />
    <meta property="twitter:image" content="http://example.org/media/icon_huc737709a4be44af6221d1cabfe197959_22580_512x512_fill_lanczos_center_2.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta
        property="article:published_time"
        content="2018-06-01T21:13:14-05:00"
      />
    
    <meta property="article:modified_time" content="2018-06-01T21:13:14-05:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://example.org/post/2018-06-01-optimal-bar-crawl/optimal_bar_crawl/"
  },
  "headline": "The Optimal Portland Pub Crawl",
  
  "datePublished": "2018-06-01T21:13:14-05:00",
  "dateModified": "2018-06-01T21:13:14-05:00",
  
  "author": {
    "@type": "Person",
    "name": "Mark LeBoeuf"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "The Code Forest",
    "logo": {
      "@type": "ImageObject",
      "url": "http://example.org/media/icon_huc737709a4be44af6221d1cabfe197959_22580_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "Portland, Oregon is home to some of the best watering holes in America. With so many places to quaff a West Coast Style IPA or glass of Pinot Noir, choosing which to visit (and in which order) can be a daunting task. To address this question, we'll leverage some classic optimization techniques to minimize the total distance travelled between the top bars in Portland for a truly \"optimal\" Pub Crawl."
}
</script>

  

  

  

  





  <title>The Optimal Portland Pub Crawl | The Code Forest</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="6907a5b6632403c0375da772713acdd7" >

  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.226a9011996d125bf3fe4a5f22353a49.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Search...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header">
    












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">The Code Forest</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">The Code Forest</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
          
          <li class="nav-item d-none d-lg-inline-flex">
            <a class="nav-link" href="/"  aria-label="">
              <i class="fas fa-" aria-hidden="true"></i>
            </a>
          </li>
        
      

      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
          <i class="fas fa-moon" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>The Optimal Portland Pub Crawl</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Jun 1, 2018
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    20 min read
  </span>
  

  
  
  
  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/r/">R</a>, <a href="/category/python/">Python</a>, <a href="/category/reticulate/">Reticulate</a>, <a href="/category/traveling-salesman-problem/">Traveling Salesman Problem</a>, <a href="/category/route-optimization/">Route Optimization</a></span>
  

</div>

    





  
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>


<p><img src="/post/2018-06-01-optimal-bar-crawl/images/portland.jpg" width="700" height="600" /></p>
<div id="overview" class="section level3">
<h3>Overview</h3>
<p>The premise of a Pub Crawl is quite simple: visit several bars in an afternoon or evening without a clear plan of where you’ll go next. While this sort of spontaneous, unstructured approach may work for some people, I’ve always been a fan of having a plan – in this case, an optimal plan. If we want to maximize the number of places visited (and beers tasted) in a finite period of time, then there is simply no room for shoddy planning. Accordingly, this post provides a framework for designing the optimal Portland Pub Crawl by working through the following steps:</p>
<p>🍺 Web Scrape the top 100 Portland bars from <a href="http://www.oregonlive.com/dining/index.ssf/2014/10/portlands_100_best_bars_bar_ta.html">here</a></p>
<p>🍺 Geocode each bar’s location</p>
<p>🍺 Find the optimal route between a subsample of the bars, because visiting 100 in a day would make the following day very bad</p>
<p>🍺 Determine a walking path between the bars</p>
<p>🍺 Create a map of the walking path, which can be use as a field guide to impress your friends once the pub crawl is under way</p>
<p>🍺 Promptly spill beer on the map at the 2nd bar, rendering it unreadable, followed by a game of darts and some popcorn</p>
<p>If that sounds like a plan, let’s get started!</p>
</div>
<div id="defining-the-top-100-bars" class="section level3">
<h3>Defining the Top 100 Bars</h3>
<p>First, let’s identify the stops during our tour of Portland’s pub scene. In the section below, we’ll load up the R libraries, identify which version of Python we’d like to use, and then do some web scraping. Note that all of the python modules and R-scripts are contained in the same directory for simplicity.</p>
<pre class="r"><code># Core package
library(tidyverse)

# Mapping
library(leaflet)
library(widgetframe)
library(leaflet.extras)

# Calling python functions from R
library(reticulate)

# Route optimization
library(tspmeta)

# Making nice tables
library(gt)</code></pre>
<p>The <code>geocode_best_portland_bars</code> function below is responsible for collecting the information.</p>
<pre class="python"><code># best_bars.py

import os
import urllib
from bs4 import BeautifulSoup
import re
from typing import List
import googlemaps
from tqdm import tqdm
import pandas as pd
from dotenv import load_dotenv

API_KEY = os.getenv(&#39;GOOGLE_API_KEY&#39;)


def find_best_bars() -&gt; str:
    base_url = &quot;http://www.oregonlive.com/dining/index.ssf/2014/10/portlands_100_best_bars_bar_ta.html&quot;
    page = urllib.request.urlopen(base_url)
    soup = BeautifulSoup(page, &quot;html.parser&quot;)
    bar_descriptors = soup.find_all(&quot;div&quot;, class_=&quot;entry-content&quot;)
    bar_descriptors = str(bar_descriptors).split(&quot;&lt;p&gt;&quot;)[0]
    best_bars_raw_lst = re.findall(r&quot;\&lt;strong&gt;(.*?)&lt;/strong&gt;&quot;, bar_descriptors)
    return best_bars_raw_lst


def clean_bar_names(raw_bar_lst: str) -&gt; List[str]:
    # exclude emphasis tags
    best_bars = [re.sub(r&quot;&lt;em&gt; (.*?)&lt;/em&gt;&quot;, &quot;&quot;, x) for x in raw_bar_lst]
    # exclude number included in bar name
    best_bars = [re.sub(r&quot;No. \d+ --&quot;, &quot;&quot;, x).strip() for x in best_bars]
    # exclude headers in all caps
    best_bars = [x for x in best_bars if not x.isupper()]
    # exclude all lower case tags
    best_bars = [x for x in best_bars if not x.islower()]
    # exclude bold tags in html
    best_bars = [x.replace(&quot;&amp;amp;&quot;, &quot;&amp;&quot;) for x in best_bars]
    # exclude other emphasis tags
    best_bars = [re.sub(r&quot;: &lt;em&gt;(.*?)&lt;/em&gt;&quot;, &quot;&quot;, x) for x in best_bars]
    # strip colons
    best_bars = [x.replace(&quot;:&quot;, &quot;&quot;) for x in best_bars]
    # exclude blanks
    best_bars = [x for x in best_bars if x]
    return best_bars


def geocode_best_portland_bars() -&gt; pd.DataFrame:
    best_bars_lst = find_best_bars()
    bar_names = clean_bar_names(raw_bar_lst=best_bars_lst)
    bar_names = [f&quot;{x}, Portland, OR&quot; for x in bar_names]
    gmaps = googlemaps.Client(key=API_KEY)
    geocoded_bars_lst = []
    for name in tqdm(bar_names):
        geocode_result = gmaps.geocode(name)
        lat_lng = geocode_result[0].get(&quot;geometry&quot;).get(&quot;location&quot;)
        lat, lng = lat_lng.get(&quot;lat&quot;), lat_lng.get(&quot;lng&quot;)
        geocoded_bars_lst.append([name, lat, lng])
    geocoded_bars_df = pd.DataFrame(geocoded_bars_lst)
    geocoded_bars_df.columns = [&quot;name&quot;, &quot;lat&quot;, &quot;lng&quot;]
    return geocoded_bars_df   </code></pre>
<p>Historically, this operation would require executing a python script, writing the results out in a .txt or .csv file, and then reading the output back into R. However, with the advent of <code>reticulate</code>, we can execute a python function and pull the output back without ever having to leave the cozy confines of R (or R-studio in this case). Recall that the actual python <code>best_bars.py</code> module, which contains the three functions defined above, is located in the same directory as our R-script. We’ll source" this function via <code>source_python</code> (which means to bring it into the R environment), then we’ll execute it. Note that we aren’t passing in any arguments; this function is designed for a particular purpose, which is to find the best watering holes in Portland.</p>
<pre class="r"><code># specify which version of Python to use
reticulate::use_python(&#39;//anaconda/bin/python&#39;, required = TRUE)

# brings our function into the R Environment
reticulate::source_python(&#39;best_bars.py&#39;)

# executes and stores the output  in our variable &#39;best_bars&#39;
best_bars = geocode_best_portland_bars()</code></pre>
<pre class="r"><code>best_bars %&gt;%
  tail(10) %&gt;%
  mutate(name = str_replace(name, &#39;, Portland, OR&#39;, &#39;&#39;)) %&gt;%
  gt() %&gt;%
  tab_header(title = gt::md(&#39;**Data Sample of Best Portland Bars**&#39;)) %&gt;%
  cols_align(
  align = &quot;center&quot;,
  columns = everything()) %&gt;%
  cols_width(
    everything() ~ px(155)
    )</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ijjoiaylpw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ijjoiaylpw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ijjoiaylpw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ijjoiaylpw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ijjoiaylpw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ijjoiaylpw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ijjoiaylpw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ijjoiaylpw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ijjoiaylpw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ijjoiaylpw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ijjoiaylpw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ijjoiaylpw .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ijjoiaylpw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ijjoiaylpw .gt_from_md > :first-child {
  margin-top: 0;
}

#ijjoiaylpw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ijjoiaylpw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ijjoiaylpw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ijjoiaylpw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ijjoiaylpw .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ijjoiaylpw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ijjoiaylpw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ijjoiaylpw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ijjoiaylpw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ijjoiaylpw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ijjoiaylpw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ijjoiaylpw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ijjoiaylpw .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ijjoiaylpw .gt_left {
  text-align: left;
}

#ijjoiaylpw .gt_center {
  text-align: center;
}

#ijjoiaylpw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ijjoiaylpw .gt_font_normal {
  font-weight: normal;
}

#ijjoiaylpw .gt_font_bold {
  font-weight: bold;
}

#ijjoiaylpw .gt_font_italic {
  font-style: italic;
}

#ijjoiaylpw .gt_super {
  font-size: 65%;
}

#ijjoiaylpw .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="ijjoiaylpw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:155px;"/>
    <col style="width:155px;"/>
    <col style="width:155px;"/>
  </colgroup>
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal" style><strong>Data Sample of Best Portland Bars</strong></th>
    </tr>
    <tr>
      <th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lat</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lng</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">Swine</td>
      <td class="gt_row gt_center">45.51827</td>
      <td class="gt_row gt_center">-122.6818</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Jackknife</td>
      <td class="gt_row gt_center">45.52051</td>
      <td class="gt_row gt_center">-122.6828</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Stammtisch</td>
      <td class="gt_row gt_center">45.52586</td>
      <td class="gt_row gt_center">-122.6375</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Cooper's Hall</td>
      <td class="gt_row gt_center">45.51988</td>
      <td class="gt_row gt_center">-122.6596</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">The Knock Back</td>
      <td class="gt_row gt_center">45.55923</td>
      <td class="gt_row gt_center">-122.6416</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Multnomah Whiskey Library</td>
      <td class="gt_row gt_center">45.52098</td>
      <td class="gt_row gt_center">-122.6835</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Trifecta Tavern &amp; Bakery</td>
      <td class="gt_row gt_center">45.51756</td>
      <td class="gt_row gt_center">-122.6596</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Angel Face</td>
      <td class="gt_row gt_center">45.52321</td>
      <td class="gt_row gt_center">-122.6371</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Pepe Le Moko</td>
      <td class="gt_row gt_center">45.52187</td>
      <td class="gt_row gt_center">-122.6813</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Expatriate</td>
      <td class="gt_row gt_center">45.56240</td>
      <td class="gt_row gt_center">-122.6346</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>We have successfully scraped the best bars and geocoded their locations. Note that you’ll need access to the Geocoding API through the Google Maps Platform to follow along with the example above. In the following section, we’ll solve a classic routing optimization problem: The Traveling Salesman Problem (TSP). The goal is to find the most direct route between all of the bars we want to visit during the pub crawl.</p>
</div>
<div id="route-optimization" class="section level3">
<h3>Route Optimization</h3>
<p>The goal of any routing optimization problem is simple: minimize the total distance traveled between different nodes (locations) in space while ensuring that each node is visited once. There are many algorithms to solve this type of problem, but we’ll leverage the <code>2-optimization</code> or <code>2-opt</code> method due to its simplicity. This algorithm finds the lowest cost route (i.e., the route with the shortest distance that ensures each node is visited once) by swapping the ‘edges’ (the path that connects two nodes) between different nodes. If a swap reduces the total length of our tour, then the swap is maintained; otherwise, the swap is reversed, and we try again with different edges. Note that the swap must ensure that a single route is always possible between all nodes. The algorithm stops when a tour is reached that cannot be improved with more swaps (see <a href="https://ocw.mit.edu/courses/sloan-school-of-management/15-053-optimization-methods-in-management-science-spring-2013/lecture-notes/MIT15_053S13_lec17.pdf">here</a> for a more in-depth explanation).</p>
<p>Before going any further, let’s plot out our bar locations. We’ll also define our starting point, which is referred to as the “depot.”</p>
<pre class="r"><code>depot_lat = 45.525915
depot_lng = -122.684957

bar_map = leaflet(data = best_bars) %&gt;% 
          setView(lng = depot_lng + 0.05, lat = depot_lat, zoom = 13) %&gt;% 
          addProviderTiles(&quot;CartoDB.Positron&quot;) %&gt;%
          addMarkers(lng=depot_lng, lat=depot_lat) %&gt;% 
          addCircleMarkers(lat=~lat, 
                           lng=~lng,
                           color = &quot;orange&quot;,
                           radius = 4,
                           weight = 10,
                           stroke = FALSE,
                           opacity = 4,
                           fillOpacity = 4
                           ) </code></pre>
<div id="htmlwidget-1" style="width:100%;height:400px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/post/2018-06-01-optimal-bar-crawl/optimal_bar_crawl_files/figure-html//widgets/widget_unnamed-chunk-7.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>Each orange dot is a bar, and the pointer indicates our starting position (the depot). Given that we are walking let’s limit the potential distance to a maximum of three miles from our starting location. The function below calculates the total feet between two points defined by a latitude/longitude coordinate.</p>
<pre class="r"><code>earth_dist = function (lat1, lng1, lat2, lng2)
{
  rad = pi/180
  a1 = lat1 * rad
  a2 = lng1 * rad
  b1 = lat2 * rad
  b2 = lng2 * rad
  dlon = b2 - a2
  dlat = b1 - a1
  a = (sin(dlat/2))^2 + cos(a1) * cos(b1) * (sin(dlon/2))^2
  c = 2 * atan2(sqrt(a), sqrt(1 - a))
  R = 6378.145
  d = R * c
  return(d* 3280.8)
}</code></pre>
<p>Below we’ll filter to all locations based on the maximum distance we’re willing to travel.</p>
<pre class="r"><code>feet_in_mile = 5280
# maximum distance is 3 miles
max_miles_away = 3

bar_locations_nearby = best_bars %&gt;% 
                       mutate(distance_from_depot = earth_dist(depot_lat,
                                                               depot_lng,
                                                               lat,
                                                               lng
                                                               )
                              ) %&gt;% 
                       filter(distance_from_depot &lt;= feet_in_mile * max_miles_away)</code></pre>
<pre class="r"><code>set.seed(1)

# we&#39;ll visit 24 bars
n_bars = 24

# randomly select 24 bars to visit
bar_locations_nearby = bar_locations_nearby %&gt;% 
                       sample_n(n_bars)</code></pre>
<p>Next, we’ll transform the lat/long locations into a distance matrix. The distance matrix specifies the euclidean distance of each bar from every other bar.</p>
<pre class="r"><code># now find optimal route
coordinates = bar_locations_nearby %&gt;% 
              dplyr::select(lat, lng, name) %&gt;% 
              mutate(location_index = 2:(n() + 1)) %&gt;% 
              bind_rows(data.frame(lat = depot_lat,
                                   lng = depot_lng,
                                   address = &#39;depot&#39;,
                                   name = &#39;depot&#39;,
                                   location_index = 1
                                          )
                               ) %&gt;% 
              arrange(location_index)

coords_matrix = coordinates %&gt;% 
                dplyr::select(lat, lng) %&gt;% 
                as.matrix()

dist_matrix = dist(coords_matrix)</code></pre>
<p>The two functions below <code>tsp_instance</code> and <code>run_solver</code> do the heavy lifting and find the optimal route between bars.</p>
<pre class="r"><code># create tsp instance
tsp_ins = tspmeta::tsp_instance(coords_matrix,dist_matrix)

# find optimal route based on 2-opt method
opt_tour = as.integer(run_solver(tsp_ins, method=&quot;2-opt&quot;))

# sort to start at depot
sorted_tour = c(opt_tour[which(opt_tour == 1):length(opt_tour)],
                opt_tour[1:(which(opt_tour == 1) - 1)]
                )

# join route order back to original data
coordinates = coordinates %&gt;% 
              dplyr::inner_join(data.frame(location_index = sorted_tour,
                                           route_order = 1:length(sorted_tour)
                                           )
                                ) %&gt;% 
              dplyr::arrange(route_order)

# reformat so each row has a starting lat/lng and ending lat/lng
route_df = coordinates %&gt;% 
            dplyr::select(-address) %&gt;%
            dplyr::rename(start_lat = lat,
                          start_lng = lng
                          ) %&gt;% 
            dplyr::mutate(end_lat = c(start_lat[2:n()], NA),
                          end_lng = c(start_lng[2:n()], NA)
                          ) %&gt;% 
            na.omit()</code></pre>
<p>Let’s take a peak at our data to see how everything turned out.</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dmhypywntg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dmhypywntg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dmhypywntg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dmhypywntg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dmhypywntg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmhypywntg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dmhypywntg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dmhypywntg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dmhypywntg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dmhypywntg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dmhypywntg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dmhypywntg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#dmhypywntg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dmhypywntg .gt_from_md > :first-child {
  margin-top: 0;
}

#dmhypywntg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dmhypywntg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dmhypywntg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#dmhypywntg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmhypywntg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#dmhypywntg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmhypywntg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dmhypywntg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dmhypywntg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmhypywntg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dmhypywntg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#dmhypywntg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dmhypywntg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#dmhypywntg .gt_left {
  text-align: left;
}

#dmhypywntg .gt_center {
  text-align: center;
}

#dmhypywntg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dmhypywntg .gt_font_normal {
  font-weight: normal;
}

#dmhypywntg .gt_font_bold {
  font-weight: bold;
}

#dmhypywntg .gt_font_italic {
  font-style: italic;
}

#dmhypywntg .gt_super {
  font-size: 65%;
}

#dmhypywntg .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="dmhypywntg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:115px;"/>
    <col style="width:115px;"/>
    <col style="width:115px;"/>
    <col style="width:115px;"/>
    <col style="width:115px;"/>
    <col style="width:115px;"/>
  </colgroup>
  <thead class="gt_header">
    <tr>
      <th colspan="6" class="gt_heading gt_title gt_font_normal" style><strong>Route</strong></th>
    </tr>
    <tr>
      <th colspan="6" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">route_order</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">start_lat</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">start_lng</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">end_lat</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">end_lng</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">depot</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">45.52591</td>
      <td class="gt_row gt_center">-122.6850</td>
      <td class="gt_row gt_center">45.52627</td>
      <td class="gt_row gt_center">-122.6784</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Park Kitchen</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">45.52627</td>
      <td class="gt_row gt_center">-122.6784</td>
      <td class="gt_row gt_center">45.52531</td>
      <td class="gt_row gt_center">-122.6783</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Remedy Wine Bar</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">45.52531</td>
      <td class="gt_row gt_center">-122.6783</td>
      <td class="gt_row gt_center">45.52201</td>
      <td class="gt_row gt_center">-122.6816</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Clyde Common</td>
      <td class="gt_row gt_center">4</td>
      <td class="gt_row gt_center">45.52201</td>
      <td class="gt_row gt_center">-122.6816</td>
      <td class="gt_row gt_center">45.52246</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Cassidy's</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">45.52246</td>
      <td class="gt_row gt_center">-122.6852</td>
      <td class="gt_row gt_center">45.52098</td>
      <td class="gt_row gt_center">-122.6835</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Multnomah Whiskey Library</td>
      <td class="gt_row gt_center">6</td>
      <td class="gt_row gt_center">45.52098</td>
      <td class="gt_row gt_center">-122.6835</td>
      <td class="gt_row gt_center">45.51487</td>
      <td class="gt_row gt_center">-122.6824</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">The Rookery at Raven &amp; Rose</td>
      <td class="gt_row gt_center">7</td>
      <td class="gt_row gt_center">45.51487</td>
      <td class="gt_row gt_center">-122.6824</td>
      <td class="gt_row gt_center">45.51400</td>
      <td class="gt_row gt_center">-122.6753</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Veritable Quandary</td>
      <td class="gt_row gt_center">8</td>
      <td class="gt_row gt_center">45.51400</td>
      <td class="gt_row gt_center">-122.6753</td>
      <td class="gt_row gt_center">45.51904</td>
      <td class="gt_row gt_center">-122.6781</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Departure</td>
      <td class="gt_row gt_center">9</td>
      <td class="gt_row gt_center">45.51904</td>
      <td class="gt_row gt_center">-122.6781</td>
      <td class="gt_row gt_center">45.52403</td>
      <td class="gt_row gt_center">-122.6756</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">Ground Kontrol</td>
      <td class="gt_row gt_center">10</td>
      <td class="gt_row gt_center">45.52403</td>
      <td class="gt_row gt_center">-122.6756</td>
      <td class="gt_row gt_center">45.51900</td>
      <td class="gt_row gt_center">-122.6641</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>Sweet! Almost there. The final step is to convert these points into an actual travel path.</p>
</div>
<div id="creating-a-walking-path" class="section level3">
<h3>Creating a Walking Path</h3>
<p>Currently, the path between different nodes (i.e., bars) are straight lines. We’ll be walking this tour, so a sidewalk travel path is required. We’ll call on the Google Maps API one last time to convert each of the straight-line edges to actual walking paths via the <code>convert_route_to_path.py</code> module. This module consists of two functions: <code>find_path</code> and <code>extract_polyline</code>. <code>find_path</code> takes a starting lat/long, ending lat/long, and method of travel (walking in our case) and returns step-by-step lat/long coordinates along with distance and time estimates. <code>extract_polyline</code> is a helper function that will format each of the step-by-step coordinates into pandas DataFrame. The output is returned as an R DataFrame. We’ll specify the python module below.</p>
<pre class="python"><code># convert_route_to_path.py
import os
import pandas as pd
import polyline
import googlemaps
from dotenv import load_dotenv

load_dotenv()

API_KEY = os.getenv(&#39;GOOGLE_API_KEY&#39;)

def extract_polyline(coords: dict) -&gt; pd.DataFrame:
    gmaps_polyline = coords[&quot;overview_polyline&quot;][&quot;points&quot;]
    polyline_df = pd.DataFrame(polyline.decode(gmaps_polyline))
    polyline_df.columns = [&quot;lat&quot;, &quot;lng&quot;]
    polyline_df[&quot;path_order&quot;] = range(1, polyline_df.shape[0] + 1)
    return polyline_df


def create_travel_path(
    route_df: pd.DataFrame, travel_mode: str = &quot;walking&quot;
) -&gt; pd.DataFrame:
    gmaps = googlemaps.Client(key=API_KEY)
    out_route_df = pd.DataFrame()
    for row in route_df.itertuples():
        coords = gmaps.directions(
            origin=[row.start_lat, row.start_lng],
            destination=[row.end_lat, row.end_lng],
            mode=travel_mode,
        )
        coords_df = extract_polyline(coords=coords[0])
        coords_df[&quot;location_index&quot;] = row.location_index
        coords_df[&quot;travel_time&quot;] = coords[0][&quot;legs&quot;][0][&quot;duration&quot;][&quot;value&quot;]
        coords_df[&quot;miles&quot;] = coords[0][&quot;legs&quot;][0][&quot;distance&quot;][&quot;text&quot;]
        coords_df[&quot;route_order&quot;] = row.route_order
        out_route_df = out_route_df.append(coords_df)
    out_route_df = out_route_df.reset_index(drop=True)
    return out_route_df</code></pre>
<p>Next, we’ll read the <code>convert_route_to_path.py</code> module into R and pass in our route DataFrame to the <code>create_travel_path</code> function.</p>
<pre class="r"><code>reticulate::source_python(&#39;convert_route_to_path.py&#39;)
path_df = create_travel_path(route_df)</code></pre>
<p>The data indicating the path between our depot and the first bar should look like this:</p>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pamufqigws .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 10px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pamufqigws .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pamufqigws .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pamufqigws .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pamufqigws .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pamufqigws .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pamufqigws .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pamufqigws .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pamufqigws .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pamufqigws .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pamufqigws .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pamufqigws .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pamufqigws .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pamufqigws .gt_from_md > :first-child {
  margin-top: 0;
}

#pamufqigws .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pamufqigws .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pamufqigws .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pamufqigws .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pamufqigws .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pamufqigws .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pamufqigws .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pamufqigws .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pamufqigws .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pamufqigws .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pamufqigws .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pamufqigws .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pamufqigws .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pamufqigws .gt_left {
  text-align: left;
}

#pamufqigws .gt_center {
  text-align: center;
}

#pamufqigws .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pamufqigws .gt_font_normal {
  font-weight: normal;
}

#pamufqigws .gt_font_bold {
  font-weight: bold;
}

#pamufqigws .gt_font_italic {
  font-style: italic;
}

#pamufqigws .gt_super {
  font-size: 65%;
}

#pamufqigws .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="pamufqigws" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
  </colgroup>
  <thead class="gt_header">
    <tr>
      <th colspan="7" class="gt_heading gt_title gt_font_normal" style><strong>Sample Travel Path</strong></th>
    </tr>
    <tr>
      <th colspan="7" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">location_index</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">route_order</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">travel_time</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">miles</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">path_order</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lat</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lng</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">45.52576</td>
      <td class="gt_row gt_center">-122.6849</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">45.52575</td>
      <td class="gt_row gt_center">-122.6853</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">45.52508</td>
      <td class="gt_row gt_center">-122.6853</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">4</td>
      <td class="gt_row gt_center">45.52449</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">45.52443</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">6</td>
      <td class="gt_row gt_center">45.52362</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">7</td>
      <td class="gt_row gt_center">45.52312</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">8</td>
      <td class="gt_row gt_center">45.52304</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">9</td>
      <td class="gt_row gt_center">45.52282</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">10</td>
      <td class="gt_row gt_center">45.52263</td>
      <td class="gt_row gt_center">-122.6853</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">11</td>
      <td class="gt_row gt_center">45.52247</td>
      <td class="gt_row gt_center">-122.6854</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">344</td>
      <td class="gt_row gt_center">0.3 mi</td>
      <td class="gt_row gt_center">12</td>
      <td class="gt_row gt_center">45.52243</td>
      <td class="gt_row gt_center">-122.6852</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>Note the small changes between each of the successive lat/long coordinates. This is the path we’ll be walking to obtain our first frosty mug of beer. Before mapping our data, let’s get a general idea of total walking time and distance.</p>
<pre class="r"><code>travel_time_in_hours = round(path_df %&gt;% 
                             dplyr::select(location_index, travel_time) %&gt;% 
                             dplyr::distinct() %&gt;% 
                             dplyr::pull(travel_time) %&gt;% 
                             sum() / 3600, 1)

print(glue::glue(&quot;Total Travel Time Is: &quot;,
                 travel_time_in_hours,
                 &quot; Hours&quot;
                 )
      )</code></pre>
<pre><code>## Total Travel Time Is: 6.6 Hours</code></pre>
<p>It looks like this walk will take around six hours, so we’ll need to bring some comfy shoes. What about distance (we’ll need some way to work off those calories)?</p>
<pre class="r"><code>travel_distance_in_miles = round(path_df %&gt;% 
  dplyr::mutate(feet_numeric = 
                case_when(stringr::str_detect(miles, &#39;ft&#39;) == TRUE ~ 
                          as.numeric(stringr::str_replace(miles, 
                                                          &quot; ft&quot;, 
                                                          &quot;&quot;
                                                          )
                                     ),
                          stringr::str_detect(miles, &quot; mi&quot;) == TRUE ~ 
                          as.numeric(stringr::str_replace(miles, 
                                                          &quot; mi&quot;, 
                                                          &quot;&quot;)
                                     ) * feet_in_mile
                         )
                ) %&gt;% 
  dplyr::select(location_index, feet_numeric) %&gt;% 
  dplyr::distinct() %&gt;% 
  dplyr::pull(feet_numeric) %&gt;% 
  sum() / feet_in_mile, 1)

print(glue::glue(&quot;Total Travel Distance Is: &quot;,
                 travel_distance_in_miles,
                 &quot; Miles&quot;
                 )
      )</code></pre>
<pre><code>## Total Travel Distance Is: 19 Miles</code></pre>
<p>OK, this is more of a Pub Crawl marathon. That’s some serious distance to cover. Let’s bring it all together with some visualization.</p>
</div>
<div id="mapping-the-route" class="section level3">
<h3>Mapping the Route</h3>
<p>The last step is to bring this analysis to life with everyone’s favorite visualization: MAPS! Indeed, we’ll plot the walking path across downtown Portland to see the Pub Crawl route.</p>
<pre class="r"><code># We&#39;ll use this to identify the labels for each stop 
label_df = path_df %&gt;%  
           dplyr::filter(path_order == 1)

# Bar crawl visualization
final_route = leaflet(data = path_df) %&gt;%
  setView(lng = depot_lng + 0.04, lat = depot_lat + 0.01, zoom = 13) %&gt;% 
  addProviderTiles(&quot;CartoDB.Positron&quot;) %&gt;%
  addPolylines(data = path_df %&gt;% 
                 filter(route_order &lt; 24),
               lng = ~lng,
               lat = ~lat,
               color = &quot;orange&quot;,
               opacity = 4
  ) %&gt;% 
  addMarkers(lng = depot_lng,
             lat = depot_lat
  ) %&gt;% 
  addCircleMarkers(data = label_df,
                   lng = ~lng,
                   lat = ~lat,
                   radius = 4,
                   label = ~as.character(route_order),
                   labelOptions = labelOptions(noHide = T,
                                               textOnly = T,
                                               direction = &#39;top&#39;,
                                               textsize = &quot;14px&quot;,
                                               offset=c(0,-5),
                                               size = 1
                   )
  )</code></pre>
<div id="htmlwidget-2" style="width:100%;height:600px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"url":"/post/2018-06-01-optimal-bar-crawl/optimal_bar_crawl_files/figure-html//widgets/widget_unnamed-chunk-21.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>Whew! That was a lot of work, but it looks like we have a reasonable solution. We’ll start in downtown Portland, take a quick tour over to the city’s Eastside, and eventually return to the Northwest. So, there you have it – a real-world application of optimization that supports an efficient Pub Crawl. Prost!</p>
</div>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/r/">R</a>
  
  <a class="badge badge-light" href="/tag/python/">Python</a>
  
  <a class="badge badge-light" href="/tag/reticulate/">Reticulate</a>
  
  <a class="badge badge-light" href="/tag/traveling-salesman-problem/">Traveling Salesman Problem</a>
  
  <a class="badge badge-light" href="/tag/route-optimization/">Route Optimization</a>
  
</div>













  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="http://example.org/"><img class="avatar mr-3 avatar-circle" src="/author/mark-leboeuf/avatar_hu95484a0837f0832a1e8242074628a955_46074_270x270_fill_q75_lanczos_center.jpg" alt="Mark LeBoeuf"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="http://example.org/">Mark LeBoeuf</a></h5>
      <h6 class="card-subtitle">Data Scientist</h6>
      
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/" >
        <i class="fas fa-"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/thecodeforest" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/markleboeuf/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>




















  </div>
</article>
  </div>

  <div class="page-footer">
    
    
    <div class="container">
      <footer class="site-footer">
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-www-thecodeforest-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</footer>

    </div>
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/sql.min.js"></script>
        
      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    

    
    
    
      
      <script id="search-hit-fuse-template" type="text/x-template">
        <div class="search-hit" id="summary-{{key}}">
          <div class="search-hit-content">
            <div class="search-hit-name">
              <a href="{{relpermalink}}">{{title}}</a>
              <div class="article-metadata search-hit-type">{{type}}</div>
              <p class="search-hit-description">{{snippet}}</p>
            </div>
          </div>
        </div>
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
      
    

    
    

    
    
    
    

    
    <script src="/js/bootstrap.bundle.min.6aed84840afc03ab4d5750157f69c120.js"></script>

    
    
      
      
      
      
      
      
      
    

    
    
    
    
    
    
    
    
      
      
    
    
    <script src="/en/js/wowchemy.min.b61a8f62b6e5c0cd322c8158c5b5dfb6.js"></script>

    
  <script async defer src="https://buttons.github.io/buttons.js"></script>




</body>
</html>
