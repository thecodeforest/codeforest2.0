---
title: "College Rankings and Pay"
date: '2021-04-11T21:13:14-05:00'
summary: College rankings are a standard input for most students when choosing a school.
  But to what extent does a college's rank relate to how much a graduate makes 10
  years into their career? We'll answer this question by web scraping data from a
  variety of online sources with R and Python, and then build a model to understand
  which factors matter most to post-college pay.
tags:
- College Rankings
- Career
- R
- Python
categories:
- College Rankings
- Career
- R
- Python
---



<p><img src="/post/2021-04-11-college-rankings-salary/images/belushi.jpg" width="700" height="400" /></p>
<div id="overview" class="section level3">
<h3>Overview</h3>
<p>Rankings are a pervasive part of modern life, especially for big decisions ‚Äì like shelling out thousands of dollars for an education. Indeed, college rankings are amongst the most widely cited rankings in existence. Students, parents, and college administrators fret about where their school lands along these highly debated spectrums. But does it really matter in terms of future earnings potential? While an education is more than a simple ‚Äúmeans to an end‚Äù, making a decent living is amongst the reasons why students pull all-nighters, work terrible summer jobs, and do everything they can to position themselves for a lucrative, meaningful career. Accordingly, this post will focus on the following topics:</p>
<p>ü§ì The relationship between Mid Career Pay and College Ranking after accounting for external variables (e.g., % of STEM degrees conferred each year)</p>
<p>ü§ì Understand which variables exhibit the strongest relationship with pay</p>
<p>ü§ì Identify which college‚Äôs graduates over/under earn relative to our predictions</p>
<p>Since I‚Äôm a big fan of Learning-by-doing, I‚Äôve included all the code used to answer these questions. If you are simply interested in the answers, <a href="#analysis">click here</a></p>
</div>
<div id="data-collection" class="section level3">
<h3>Data Collection</h3>
<p>We‚Äôll leverage the following data sources for our analysis:</p>
<ul>
<li><p>Payscale Data of Median Mid Career Earnings By College (with additional data about each college)</p></li>
<li><p>Forbes Undergraduate College Rankings</p></li>
<li><p>Cost of Living Index by State</p></li>
</ul>
<p>The data is stored across various websites, so we‚Äôll need to first scrape and format it prior to doing any analysis. For example, the <code>collect_cost_of_living_data.py</code> module below will scrape a table with cost of living data for each US state.</p>
<pre class="python"><code># college_cost_of_living_data.py
import urllib
from bs4 import BeautifulSoup
import re
import pandas as pd
from datetime import datetime
from typing import List
import logging

start_time = datetime.now().strftime(&quot;%Y-%m-%d %H-%M-%S&quot;)
logging.basicConfig(
    filename=f&quot;college-rankings-pay-{start_time}.log&quot;,
    format=&quot;%(levelname)s - %(asctime)s - %(filename)s - %(message)s&quot;,
    level=logging.DEBUG,
)
logger = logging.getLogger(__name__)


def scrape_col_data() -&gt; List[str]:
    base_url = &quot;https://meric.mo.gov/data/cost-living-data-series&quot;
    page = urllib.request.urlopen(base_url).read()
    soup = BeautifulSoup(page)
    col_data = soup.findAll(&quot;tbody&quot;)[0].findAll(&quot;tr&quot;)
    col_data_lst = str(col_data).split(&quot;&lt;/tr&gt;&quot;)
    return col_data_lst


def format_col_data(col_data_lst: List[str]) -&gt; pd.DataFrame:
    field_names = [&quot;state&quot;, &quot;cost_of_living&quot;]
    regex_state = re.compile(&quot;&gt;[0-9]{1,2}&lt;/td&gt;\n&lt;td&gt;(.+?)\xa0&lt;&quot;)
    regex_col_index = re.compile(&quot;\xa0&lt;/td&gt;\n&lt;td&gt;([0-9]{2,3}.\d)&lt;/td&gt;&quot;)
    all_states_col = list()
    for state in col_data_lst:
        try:
            state_name = re.search(regex_state, state).group(1)
            state_col = re.search(regex_col_index, state).group(1)
            row = [state_name, state_col]
            all_states_col.append(row)
        except Exception as e:
            logger.error(
                f&quot;Problem extract table from wikipedia for {state}&quot;, exc_info=True
            )
    all_states_df = pd.DataFrame(all_states_col, columns=field_names)
    return all_states_df


def collect_col_data() -&gt; pd.DataFrame():
    col_data_lst = scrape_col_data()
    col_df = format_col_data(col_data_lst=col_data_lst)
    return col_df</code></pre>
<pre class="r"><code># Core package
library(tidyverse)

# Calling python functions from R
library(reticulate)

# specify which version of Python to use
reticulate::use_python(&#39;//anaconda/bin/python&#39;, required = TRUE)

# brings our function into the R Environment
reticulate::source_python(&#39;college_cost_of_living_data.py&#39;)

# executes and stores the output in our variable &#39;cost_of_living_df&#39;
col_df = collect_col_data()</code></pre>
<p>The code for the other two data sources - <code>collect_payscale_data</code> and - <code>collect_rankings_data</code> - can be found in the appendix. If you want to follow along with analysis but avoid all of the web-scraping, you can simply pull the data directly into R by executing the block below:</p>
<pre class="r"><code>url = &quot;https://raw.githubusercontent.com/thecodeforest/codeforest_datasets/main&quot;
post_location = &quot;college_rankings_salary_data&quot;
full_path = file.path(url, post_location)
col_df &lt;- read_csv(file.path(full_path, &#39;cost_of_living.csv&#39;)) %&gt;% clean_names()
pay_df &lt;- read_csv(file.path(full_path, &#39;college_pay.csv&#39;)) %&gt;% clean_names()
ranks_df &lt;- read_csv(file.path(full_path, &#39;college_ranks.csv&#39;)) %&gt;% clean_names()</code></pre>
<p>Let‚Äôs start by doing some basic data cleaning and examining our pay dataset.</p>
<pre class="r"><code>pay_df_clean &lt;- pay_df %&gt;% 
  clean_names() %&gt;% 
  rename(college_name = name) %&gt;% 
  select(college_name, type, state, rank, early_pay, mid_pay, pct_stem) %&gt;% 
  mutate(college_name = str_to_lower(college_name),
         college_name = str_replace_all(college_name, &quot;_&quot;, &quot; &quot;),
         pct_stem = parse_number(pct_stem),
         early_pay = parse_number(early_pay),
         mid_pay = parse_number(mid_pay)
         )</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#vpufhdntpz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 10px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vpufhdntpz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vpufhdntpz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vpufhdntpz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vpufhdntpz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vpufhdntpz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vpufhdntpz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vpufhdntpz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vpufhdntpz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vpufhdntpz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vpufhdntpz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vpufhdntpz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#vpufhdntpz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vpufhdntpz .gt_from_md > :first-child {
  margin-top: 0;
}

#vpufhdntpz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vpufhdntpz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vpufhdntpz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#vpufhdntpz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vpufhdntpz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#vpufhdntpz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vpufhdntpz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vpufhdntpz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vpufhdntpz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vpufhdntpz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vpufhdntpz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#vpufhdntpz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vpufhdntpz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#vpufhdntpz .gt_left {
  text-align: left;
}

#vpufhdntpz .gt_center {
  text-align: center;
}

#vpufhdntpz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vpufhdntpz .gt_font_normal {
  font-weight: normal;
}

#vpufhdntpz .gt_font_bold {
  font-weight: bold;
}

#vpufhdntpz .gt_font_italic {
  font-style: italic;
}

#vpufhdntpz .gt_super {
  font-size: 65%;
}

#vpufhdntpz .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="vpufhdntpz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
  </colgroup>
  <thead class="gt_header">
    <tr>
      <th colspan="7" class="gt_heading gt_title gt_font_normal" style><strong>Sample Compensentation Data</strong></th>
    </tr>
    <tr>
      <th colspan="7" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">college_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">state</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">rank</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">early_pay</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">mid_pay</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">pct_stem</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">harvey mudd college</td>
      <td class="gt_row gt_center">Engineering, Liberal Arts School, Private School</td>
      <td class="gt_row gt_center">California</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">91400</td>
      <td class="gt_row gt_center">162500</td>
      <td class="gt_row gt_center">85</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">massachusetts institute of technology (mit)</td>
      <td class="gt_row gt_center">Engineering, Private School, Research University</td>
      <td class="gt_row gt_center">Massachusetts</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">88300</td>
      <td class="gt_row gt_center">158100</td>
      <td class="gt_row gt_center">69</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">united states naval academy (usna) at annapolis</td>
      <td class="gt_row gt_center">Engineering, Liberal Arts School, Sober School, For Sports Fans, State School</td>
      <td class="gt_row gt_center">Maryland</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">79600</td>
      <td class="gt_row gt_center">152600</td>
      <td class="gt_row gt_center">58</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">princeton university</td>
      <td class="gt_row gt_center">Ivy League, Private School, Research University, For Sports Fans</td>
      <td class="gt_row gt_center">New Jersey</td>
      <td class="gt_row gt_center">4</td>
      <td class="gt_row gt_center">77300</td>
      <td class="gt_row gt_center">150500</td>
      <td class="gt_row gt_center">48</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">california institute of technology (caltech)</td>
      <td class="gt_row gt_center">Engineering, Private School, Research University</td>
      <td class="gt_row gt_center">California</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">87600</td>
      <td class="gt_row gt_center">150300</td>
      <td class="gt_row gt_center">97</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>In the next few steps, we‚Äôll bring together our other two datasets, starting with cost of living data. This step is straightfoward, we‚Äôll bring in <code>cost_of_living</code> by state to adjust for the effect of cost of living.</p>
<pre class="r"><code>pay_df_clean &lt;- left_join(pay_df_clean, col_df, on=&#39;state&#39;)</code></pre>
<p>The next step is a bit trickier. We‚Äôll be joining on the name of the college. Anyone who has spent a few minutes working with data knows it‚Äôs never a good thing to join on strings. I came across this tweet the other day, which perfectly captures what we‚Äôre trying to do here.</p>
<p><img src="/post/2021-04-11-college-rankings-salary/images/philadelphia.png" width="400" height="200" /></p>
<pre class="r"><code>pay_df_clean &lt;- pay_df_clean %&gt;% 
  mutate(college_name = str_replace_all(college_name, &quot; \\(.+?\\)&quot;, &quot;&quot;),
        college_name = str_replace_all(college_name, &#39;%2c&#39;, &#39;,&#39;),
        college_name = str_replace_all(college_name, &#39;%26&#39;, &#39;&amp;&#39;),
        college_name = str_replace_all(college_name, &#39;%27&#39;, &quot;&#39;&quot;),
        college_name = str_replace_all(college_name, &#39;at (.+/?)&#39;, &#39;&#39;), 
        college_name = str_replace_all(college_name, &#39;,\\s[a-z][a-z]&#39;, &#39;&#39;), # state at end
        college_name = str_replace_all(college_name, &#39; - &#39;, &#39;-&#39;),
        college_name = str_trim(college_name)
        )</code></pre>
<p>Next, we‚Äôll do some light cleaning to the other data.</p>
<pre class="r"><code>ranks_df_clean &lt;- ranks_df %&gt;% 
  rename(college_name = friendly_name,
         college_rank = rank
         ) %&gt;% 
  mutate(college_name = tolower(college_name)) %&gt;% 
  na.omit()</code></pre>
<p>Now we‚Äôll do fuzzy join based on stringdist. This will lead to two issues. Some records wil drop, and there can be duplicates. We‚Äôll check for both.</p>
<pre class="r"><code>analysis_df &lt;- stringdist_inner_join(pay_df_clean, 
                                     ranks_df_clean,
                                     by=&#39;college_name&#39;,
                                     max_dist=2
                                     )
n_row_reduced &lt;- nrow(pay_df_clean) - nrow(analysis_df)
print(glue::glue(&#39;N rows reduced: {n_row_reduced}&#39;))</code></pre>
<pre><code>## N rows reduced: 175</code></pre>
<p>Next need to check if there instances of duplicates, which can happen when names are close to one another. For example.</p>
<pre class="r"><code>analysis_df &lt;- analysis_df %&gt;% 
  group_by(college_name.x) %&gt;% 
  mutate(n_match = 1:n()) %&gt;% 
  ungroup()

analysis_df %&gt;% 
  filter(college_name.x %in% c(&#39;stanford university&#39;, &#39;brown university&#39;)) %&gt;% 
  select(contains(&#39;_name&#39;), n_match) %&gt;% 
  gt() %&gt;%
  tab_header(title = gt::md(&#39;**Names with Multiple Matches**&#39;)) %&gt;%
  cols_align(
  align = &quot;center&quot;,
  columns = everything()) %&gt;%
  tab_options(table.font.size = 10) %&gt;% 
  cols_width(
    everything() ~ px(100) 
    )</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lodecjdiyh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 10px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lodecjdiyh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lodecjdiyh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lodecjdiyh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lodecjdiyh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lodecjdiyh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lodecjdiyh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lodecjdiyh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lodecjdiyh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lodecjdiyh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lodecjdiyh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lodecjdiyh .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lodecjdiyh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lodecjdiyh .gt_from_md > :first-child {
  margin-top: 0;
}

#lodecjdiyh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lodecjdiyh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lodecjdiyh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#lodecjdiyh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lodecjdiyh .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#lodecjdiyh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lodecjdiyh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lodecjdiyh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lodecjdiyh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lodecjdiyh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lodecjdiyh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#lodecjdiyh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lodecjdiyh .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#lodecjdiyh .gt_left {
  text-align: left;
}

#lodecjdiyh .gt_center {
  text-align: center;
}

#lodecjdiyh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lodecjdiyh .gt_font_normal {
  font-weight: normal;
}

#lodecjdiyh .gt_font_bold {
  font-weight: bold;
}

#lodecjdiyh .gt_font_italic {
  font-style: italic;
}

#lodecjdiyh .gt_super {
  font-size: 65%;
}

#lodecjdiyh .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="lodecjdiyh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table" style="table-layout: fixed;; width: 0px">
  <colgroup>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
    <col style="width:100px;"/>
  </colgroup>
  <thead class="gt_header">
    <tr>
      <th colspan="3" class="gt_heading gt_title gt_font_normal" style><strong>Names with Multiple Matches</strong></th>
    </tr>
    <tr>
      <th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style></th>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">college_name.x</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">college_name.y</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">n_match</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">stanford university</td>
      <td class="gt_row gt_center">stanford university</td>
      <td class="gt_row gt_center">1</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">stanford university</td>
      <td class="gt_row gt_center">samford university</td>
      <td class="gt_row gt_center">2</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">brown university</td>
      <td class="gt_row gt_center">brown university</td>
      <td class="gt_row gt_center">1</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">brown university</td>
      <td class="gt_row gt_center">rowan university</td>
      <td class="gt_row gt_center">2</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>An easy way to address this issue is to simply take the closest match. Fortunately, they are rank ordered so we just have to take the first match and exclude matches with a rank other than 1.</p>
<pre class="r"><code>analysis_df &lt;- analysis_df %&gt;% 
  filter(n_match == 1) %&gt;% 
  select(-n_match, college_name.y) %&gt;% 
  rename(college_name = college_name.x) %&gt;% 
  na.omit()</code></pre>
</div>
<div id="appendix" class="section level3">
<h3>Appendix</h3>
<pre class="python"><code># collect_payscale_data.py
import urllib
from bs4 import BeautifulSoup
import re
import pandas as pd
from typing import List
import time
from tqdm import tqdm

N_PAGES = 20

def scrape_pay_data(page_number: int) -&gt; List:
    base_url = f&quot;https://www.payscale.com/college-salary-report/bachelors/page/{str(page_number)}&quot;
    page = urllib.request.urlopen(base_url).read()
    soup = BeautifulSoup(page)
    college_data = soup.findAll(&quot;tbody&quot;)[0].findAll(&quot;tr&quot;)
    college_data = [str(x) for x in college_data]
    return college_data


def format_pay_data(college_data: str) -&gt; pd.DataFrame:
    field_names = [&quot;name&quot;, &quot;rank&quot;, &quot;type&quot;, &quot;pct_stem&quot;, &quot;early_pay&quot;, &quot;mid_pay&quot;]
    regex_name = re.compile(&#39;&lt;a href=&quot;/research/US/School=(.+?)/Salary&#39;)
    regex_rank = re.compile(
        &#39;&quot;&gt;Rank&lt;!-- --&gt;:&lt;/span&gt;&lt;span class=&quot;data-table__value&quot;&gt;(.+?)&lt;/span&gt;&#39;
    )
    regex_type = re.compile(
        &#39;&gt;School Type&lt;!-- --&gt;:&lt;/span&gt;&lt;span class=&quot;data-table__value&quot;&gt;(.+?)&lt;/span&gt;&#39;
    )
    regex_early_pay = re.compile(
        &#39;&gt;Early Career Pay&lt;!-- --&gt;:&lt;/span&gt;&lt;span class=&quot;data-table__value&quot;&gt;(.+?)&lt;/span&gt;&#39;
    )
    regex_mid_pay = re.compile(
        &#39;&gt;Mid-Career Pay&lt;!-- --&gt;:&lt;/span&gt;&lt;span class=&quot;data-table__value&quot;&gt;(.+?)&lt;/span&gt;&#39;
    )
    regex_pct_stem = re.compile(
        &#39;&gt;% STEM Degrees&lt;!-- --&gt;:&lt;/span&gt;&lt;span class=&quot;data-table__value&quot;&gt;(.+?)&lt;/span&gt;&#39;
    )
    all_college_data = list()
    # TO DO - ADD LOGGING
    for college in college_data:
        try:
            name = re.search(regex_name, college).group(1)
            rank = re.search(regex_rank, college).group(1)
            type_ = re.search(regex_type, college).group(1)
            early_pay = re.search(regex_early_pay, college).group(1)
            mid_pay = re.search(regex_mid_pay, college).group(1)
            pct_stem = re.search(regex_pct_stem, college).group(1)
            row = [name, rank, type_, pct_stem, early_pay, mid_pay]
            all_college_data.append(row)
        except Exception as e:
            print(e)
    college_df = pd.DataFrame(all_college_data, columns=FIELD_NAMES)
    return college_df


def collect_payscale_college_salary_data() -&gt; pd.DataFrame:
    all_colleges_df = pd.DataFrame(columns=FIELD_NAMES)
    for page_number in tqdm(range(1, (N_PAGES + 1))):
        college_data = scrape_pay_data(page_number=page_number)
        college_data_df = format_pay_data(college_data=college_data)
        all_colleges_df = all_colleges_df.append(college_data_df)
        time.sleep(2)
    return all_colleges_df</code></pre>
</div>
